"use client";

import Link from "next/link";
import { AnimatePresence, motion } from "framer-motion";
import { useState, useEffect, useMemo } from "react";
import { useParams, useRouter, useSearchParams } from "next/navigation";
import { supabase } from "@/lib/supabaseClient";
import { Skeleton, CircularProgress } from "@mui/material";
import { useLoginUser } from "@/context/login";
import SnackbarComponent from "@/components/Snackbar";

import { useFavorites } from "@/hooks/favorites/useFavorites";
import { useConsultationsList } from "@/hooks/consultations/useConsultationsList";
import { useCompanyDetails } from "@/hooks/consultations/useCompanyDetails";
import { useContactsByCompany } from "@/hooks/manage/customers/useContactsByCompany";
import { useConsultationContacts } from "@/hooks/consultations/useConsultationContacts";
import { useUsersList } from "@/hooks/useUserList";
import { useAddConsultation } from "@/hooks/consultations/useAddConsultation";
import { useAssignConsultationContact } from "@/hooks/consultations/useAssignConsultationContact";
import { useUpdateConsultation } from "@/hooks/consultations/useUpdateConsultation";
import FileUpload from "@/components/consultations/FileUpload";
import { useUpdateContacts } from "@/hooks/manage/customers/useUpdateContacts";

interface Consultation {
  id: string;
  date: string;
  content: string;
  follow_up_date: any;
  user_id: string;
  contact_name: string;
  contact_level: string;
  documents: {
    estimate: boolean;
    order: boolean;
    requestQuote: boolean;
  };
}
interface Contact {
  id: string;
  contact_name: string;
  mobile: string;
  department: string;
  level: string;
  email: string;
  resign: boolean;
}

interface Company {
  id: string;
  name: string;
  address: string;
  phone: string;
  email: string;
  fax: string;
  notes: string;
  business_number: string;
}

interface User {
  id: string;
  name: string;
  level: string;
}

export default function ConsultationPage() {
  const { id } = useParams();
  const router = useRouter();
  const loginUser = useLoginUser();
  const searchParams = useSearchParams();

  const [saving, setSaving] = useState(false);
  const [snackbarMessage, setSnackbarMessage] = useState<string>("");
  const [openAddModal, setOpenAddModal] = useState(false);
  const [openEditModal, setOpenEditModal] = useState(false);

  const [deleteReason, setDeleteReason] = useState("");
  const [newConsultation, setNewConsultation] = useState({
    date: new Date().toISOString().split("T")[0],
    follow_up_date: "",
    contact_name: "",
    user_id: "",
    content: "",
  });

  const [currentPage, setCurrentPage] = useState(1);
  const [selectedConsultation, setSelectedConsultation] =
    useState<Consultation | null>(null);

  const [openEditNotesModal, setOpenEditNotesModal] = useState(false);
  const [openEditContactsModal, setOpenEditContactsModal] = useState(false);
  const [openDeleteModal, setOpenDeleteModal] = useState(false);
  const [consultationToDelete, setConsultationToDelete] =
    useState<Consultation | null>(null);

  /// swr ///////
  const { users } = useUsersList();

  const { favorites, removeFavorite, refetchFavorites, addFavorite } =
    useFavorites(loginUser?.id);
  const { consultations, totalPages, refreshConsultations } =
    useConsultationsList(id as string, currentPage);

  const {
    companyDetail,
    isLoading: isCompanyDetailLoading,
    refreshCompany,
  } = useCompanyDetails(id as any);

  const { contacts, refreshContacts } = useContactsByCompany([id] as any);

  const consultationIds = consultations?.map((con: any) => con.id) || [];
  const { contactsConsultations, refreshContactsConsultations } =
    useConsultationContacts(consultationIds);

  const { addConsultation, isAdding } = useAddConsultation();
  const { assignConsultationContact } = useAssignConsultationContact();

  const { updateConsultation, isUpdating } = useUpdateConsultation();

  //// swr ////////

  const [notes, setNotes] = useState(companyDetail?.notes || "");

  const handleUpdateNotes = async () => {
    if (!companyDetail?.id) return;

    try {
      const { error } = await supabase
        .from("companies")
        .update({ notes })
        .eq("id", companyDetail.id);

      await refreshCompany();

      if (error) {
        setSnackbarMessage("ÎπÑÍ≥† ÏàòÏ†ï Ïã§Ìå®");
      } else {
        setSnackbarMessage("ÎπÑÍ≥† ÏàòÏ†ï ÏôÑÎ£å");
        setOpenEditNotesModal(false);
      }
    } catch (error) {
      setSnackbarMessage("ÎπÑÍ≥† ÏàòÏ†ï Ï§ë Ïò§Î•ò Î∞úÏÉù");
    }
  };

  const processedConsultations = useMemo(() => {
    return consultations?.map((consultation: any) => {
      // üîπ ÏÉÅÎã¥ IDÏóê Ìï¥ÎãπÌïòÎäî Ïó∞ÎùΩÏ≤ò Ï†ïÎ≥¥ Ï∞æÍ∏∞
      const contactRelation = contactsConsultations.find(
        (cc: any) => cc.consultation_id === consultation.id
      );

      // üîπ `Partial<Contact>`Î°ú Îπà Í∞ùÏ≤¥Ïùò ÌÉÄÏûÖ ÏßÄÏ†ï
      const firstContact: any = contactRelation?.contacts || {};

      // üîπ Î¨∏ÏÑú Î≥ÄÌôò Î°úÏßÅ
      const documentTypes = {
        estimate: false,
        order: false,
        requestQuote: false,
      };

      consultation.documents?.forEach((doc: { type: string }) => {
        if (doc.type === "estimate") documentTypes.estimate = true;
        if (doc.type === "order") documentTypes.order = true;
        if (doc.type === "requestQuote") documentTypes.requestQuote = true;
      });

      return {
        ...consultation,
        contact_name: firstContact.contact_name || "",
        contact_level: firstContact.level || "",
        contact_email: firstContact.email || "",
        contact_mobile: firstContact.mobile || "",
        documents: documentTypes, // üîπ Î≥ÄÌôòÎêú documents Ï†ÅÏö©
      };
    });
  }, [consultations, contactsConsultations]);

  const handleAddConsultation = async () => {
    if (isAdding) return;

    const { content, follow_up_date, user_id, contact_name } = newConsultation;

    if (!content) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
      return;
    }

    if (!contact_name) {
      setSnackbarMessage("Îã¥ÎãπÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
      return;
    }

    const formattedFollowUpDate = follow_up_date ? follow_up_date : null;

    try {
      setSaving(true);

      const addedConsultation = await addConsultation({
        method: "POST",
        body: {
          date: new Date().toISOString().split("T")[0],
          company_id: id as string,
          content,
          follow_up_date: formattedFollowUpDate,
          user_id,
        },
      });

      if (!addedConsultation?.consultation_id) {
        throw new Error("ÏÉÅÎã¥ Ï∂îÍ∞Ä Ïã§Ìå®");
      }

      // üîπ Îã¥ÎãπÏûê Ï∞æÍ∏∞
      const selectedContact = contacts.find(
        (c: Contact) => c.contact_name === contact_name
      );

      if (!selectedContact) {
        throw new Error("Îã¥ÎãπÏûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
      }

      // üîπ ÏÉÅÎã¥-Îã¥ÎãπÏûê Ïó∞Í≤∞
      await assignConsultationContact({
        method: "POST",
        body: {
          consultation_id: addedConsultation.consultation_id,
          contact_id: selectedContact.id,
          user_id,
        },
      });

      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä ÏôÑÎ£å");
      setOpenAddModal(false);
      await refreshConsultations();
      await refreshContactsConsultations();
    } catch (error) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Ï§ë Ïò§Î•ò Î∞úÏÉù");
    } finally {
      setSaving(false);
    }
  };

  const handleEditConsultation = (consultation: Consultation) => {
    setSelectedConsultation(consultation);
    setNewConsultation({
      date: consultation.date,
      follow_up_date: consultation.follow_up_date,
      user_id: consultation.user_id,
      content: consultation.content,
      contact_name: consultation.contact_name,
    });
    setOpenEditModal(true);
  };

  const handleUpdateConsultation = async () => {
    if (isUpdating) return;

    const { content, follow_up_date, user_id, contact_name } = newConsultation;

    if (!content || !user_id || !contact_name) {
      setSnackbarMessage("ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
      return;
    }

    const selectedContact = contacts.find(
      (c: Contact) => c.contact_name === contact_name
    );

    if (!selectedContact) {
      setSnackbarMessage("Îã¥ÎãπÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
      return;
    }

    try {
      setSaving(true);

      // ‚úÖ SWR Mutation Ìò∏Ï∂ú
      await updateConsultation({
        method: "PATCH",
        body: {
          consultation_id: selectedConsultation?.id,
          content,
          follow_up_date,
          user_id,
          contact_id: selectedContact.id,
        },
      });

      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï ÏôÑÎ£å");
      setOpenEditModal(false);
      await refreshConsultations();
      await refreshContactsConsultations();
    } catch (error) {
      setSnackbarMessage("ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Ï§ë Ïò§Î•ò Î∞úÏÉù");
    } finally {
      setSaving(false);
    }
  };

  const handleDeleteConsultation = async (consultation: Consultation) => {
    setConsultationToDelete(consultation);
    setOpenDeleteModal(true);
  };

  const handleConfirmDelete = async () => {
    if (!consultationToDelete) return;
    if (deleteReason.length === 0) return;

    try {
      const { error } = await supabase.from("deletion_requests").insert([
        {
          related_id: consultationToDelete.id,
          status: "pending",
          type: "consultations",
          request_date: new Date(),
          user_id: loginUser?.id || "",
          delete_reason: deleteReason,
          content: {
            consultations: `ÏÉÅÎã¥ÏÇ≠Ï†ú : ${consultationToDelete?.contact_name} ${consultationToDelete?.contact_level} ${consultationToDelete?.content}`,
          },
        },
      ]);

      if (error) {
        setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ÏùÑ ÏÉùÏÑ±ÌïòÎäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
      } else {
        setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.");

        setOpenDeleteModal(false);
      }
    } catch (error) {
      setSnackbarMessage("ÏÇ≠Ï†ú ÏöîÏ≤≠ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
    }
  };

  const prevPage = () => {
    if (currentPage > 1) {
      setCurrentPage(currentPage - 1);
    }
  };

  const nextPage = () => {
    if (currentPage < totalPages) {
      setCurrentPage(currentPage + 1);
    }
  };

  const handlePageClick = (page: number) => {
    setCurrentPage(page);
    router.push(`/consultations/${id}?page=${page}`, { scroll: false });
  };

  const paginationNumbers = () => {
    let pageNumbers = [];
    for (let i = 1; i <= totalPages; i++) {
      if (
        i === 1 ||
        i === totalPages ||
        (i >= currentPage - 2 && i <= currentPage + 2)
      ) {
        pageNumbers.push(i);
      } else if (i === currentPage - 3 || i === currentPage + 3) {
        pageNumbers.push("...");
      }
    }
    return pageNumbers;
  };

  const formatContentWithLineBreaks = (content: string) => {
    return content.split("\n").map((line, index) => (
      <span key={index}>
        {line}
        <br />
      </span>
    ));
  };

  const handleAddFavorite = async () => {
    try {
      await addFavorite(loginUser?.id, id, companyDetail?.name);
      await refetchFavorites();

      setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.");
    } catch (error) {
      console.error("Error fetching performance data:", error);
    }
  };

  const handleRemoveFavorite = async (id: string) => {
    try {
      await removeFavorite(id);
      await refetchFavorites();
      setSnackbarMessage("Ï¶êÍ≤®Ï∞æÍ∏∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
    } catch (error) {
      console.error("Error removing favorite:", error);
    }
  };

  useEffect(() => {
    // üîπ Ï≤´ Î≤àÏß∏ Îã¥ÎãπÏûêÎ•º Ï∞æÍ≥†, ÏóÜÏúºÎ©¥ Ïú†ÏßÄ
    const defaultContactName =
      contacts.length > 0
        ? contacts[0].contact_name
        : newConsultation.contact_name;
    const defaultUserId = loginUser?.id ?? newConsultation.user_id;

    // üîπ ÏÉÅÌÉú Î≥ÄÍ≤ΩÏù¥ ÌïÑÏöîÌï† ÎïåÎßå Ïã§Ìñâ
    if (
      newConsultation.contact_name !== defaultContactName ||
      newConsultation.user_id !== defaultUserId
    ) {
      setNewConsultation((prev) => ({
        ...prev,
        contact_name: defaultContactName,
        user_id: defaultUserId,
      }));
    }
  }, [contacts, loginUser]);

  useEffect(() => {
    // üîπ URLÏóêÏÑú page Í∞íÏùÑ ÏùΩÏñ¥ÏÑú ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    const pageParam = searchParams.get("page");
    if (pageParam) {
      setCurrentPage(Number(pageParam));
    }
  }, [searchParams]);

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === "Escape") {
        setOpenAddModal(false);
        setOpenEditModal(false);
        setOpenDeleteModal(false);
        setOpenEditNotesModal(false);
        setOpenEditContactsModal(false);
      }
    };

    window.addEventListener("keydown", handleKeyDown);

    return () => {
      window.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  const [contactsUi, setContactsUi] = useState<any>(contacts ?? []);
  const { updateContacts } = useUpdateContacts();

  useEffect(() => {
    if (contacts && JSON.stringify(contactsUi) !== JSON.stringify(contacts)) {
      setContactsUi(contacts);
    }
  }, [contacts]);

  const addContact = () => {
    setContactsUi((prev: any) => [
      {
        contact_name: "",
        mobile: "",
        department: "",
        level: "",
        email: "",
        resign: false,
      },
      ...prev,
    ]);
  };

  const handleUpdateContacts = async () => {
    setSaving(true);

    try {
      await updateContacts(contactsUi, contacts[0].company_id);
      await refreshContacts();
      await refreshContactsConsultations();
      setSnackbarMessage("Í±∞ÎûòÏ≤ò ÏàòÏ†ï ÏôÑÎ£å");
      setOpenEditContactsModal(false);
    } catch (error) {
      console.error("Error updating company:", error);
      setSnackbarMessage("Í±∞ÎûòÏ≤ò ÏàòÏ†ï Ïã§Ìå®");
    } finally {
      setSaving(false);
    }
  };

  const handleContactChange = (
    index: number,
    field: keyof Contact,
    value: any
  ) => {
    setContactsUi((prev: any) => {
      const updatedContact = [...prev];
      updatedContact[index] = { ...updatedContact[index], [field]: value };
      return updatedContact;
    });
  };

  const removeContact = (index: number) => {
    const updatedContact = [...contactsUi];

    updatedContact.splice(index, 1);
    setContactsUi(updatedContact);
  };

  return (
    <div className="text-sm text-[#37352F]">
      <>
        <div className="mb-4">
          <Link
            href="/customers"
            className="text-blue-500 hover:underline hover:font-bold"
          >
            Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨
          </Link>{" "}
          &gt; <span className="font-semibold">{companyDetail?.name}</span> &gt;
          ÏÉÅÎã¥ÎÇ¥Ïó≠
        </div>

        {/* üöÄ Í±∞ÎûòÏ≤ò Í∏∞Î≥∏ Ï†ïÎ≥¥ */}

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3  h-48 flex flex-col justify-between">
            {isCompanyDetailLoading ? (
              <>
                <Skeleton variant="text" width="100%" height="100%" />
              </>
            ) : (
              <div>
                <h2 className="font-semibold text-md mb-1">Í±∞ÎûòÏ≤ò</h2>
                <ul className="space-y-1 text-gray-700 text-sm pl-1">
                  <li className="flex items-center">
                    <span className="font-medium w-14">ÌöåÏÇ¨Î™Ö</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.name}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ï£ºÏÜå</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.address ||
                        "Í±∞ÎûòÏ≤òÍ≤ÄÏÉâ -> ÏàòÏ†ï Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Î∞∞ÏÜ°</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.parcel ||
                        "Í±∞ÎûòÏ≤òÍ≤ÄÏÉâ -> ÏàòÏ†ï Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ï†ÑÌôî</span>
                    <span className="flex-1">
                      {companyDetail?.phone ||
                        "Í±∞ÎûòÏ≤òÍ≤ÄÏÉâ -> ÏàòÏ†ï Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ìå©Ïä§</span>
                    <span className="flex-1">
                      {companyDetail?.fax ||
                        "Í±∞ÎûòÏ≤òÍ≤ÄÏÉâ -> ÏàòÏ†ï Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}
                    </span>
                  </li>
                  <li className="flex items-center">
                    <span className="font-medium w-14">Ïù¥Î©îÏùº</span>
                    <span className="flex-1 truncate">
                      {companyDetail?.email ||
                        "Í±∞ÎûòÏ≤òÍ≤ÄÏÉâ -> ÏàòÏ†ï Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."}
                    </span>
                  </li>
                </ul>
              </div>
            )}
          </div>

          <div className="bg-[#FBFBFB] rounded-md border px-4 pt-3 h-48 flex flex-col">
            {isCompanyDetailLoading ? (
              <>
                <Skeleton variant="text" width="100%" height="100%" />
              </>
            ) : (
              <>
                <h2 className="font-semibold text-md mb-1">Îã¥ÎãπÏûê</h2>

                <div className=" h-28 overflow-y-auto">
                  <table className="w-full text-xs border-collapse">
                    <thead className="border-b font-semibold bg-gray-100 sticky top-0"></thead>
                    <tbody className="text-sm">
                      {contacts?.map((contact: any, index: any) => {
                        if (!contact.resign)
                          return (
                            <tr
                              key={index}
                              className={`${
                                index !== contacts.length - 1 ? "border-b" : ""
                              }`}
                            >
                              <td
                                className="px-1 py-1 text-blue-500 cursor-pointer hover:font-semibold"
                                onClick={() =>
                                  router.push(`/manage/contacts/${contact.id}`)
                                }
                              >
                                {contact.contact_name}
                              </td>
                              <td className="px-1 py-1">{contact.level}</td>
                              <td className="px-1 py-1">
                                {contact.department}
                              </td>
                              <td className="px-1 py-1">{contact.mobile}</td>
                              <td className="px-1 py-1 truncate">
                                {contact.email}
                              </td>
                            </tr>
                          );
                      })}
                    </tbody>
                  </table>
                </div>
              </>
            )}
          </div>

          <div className="bg-[#FBFBFB] rounded-md border pl-4 pt-3">
            {isCompanyDetailLoading ? (
              <Skeleton variant="rectangular" width="100%" height="100%" />
            ) : (
              <>
                <h2 className="font-semibold text-md mb-1">ÎπÑÍ≥†</h2>
                <div className="text-sm min-h-[80px] max-h-28 overflow-y-auto px-1">
                  <span>
                    {companyDetail?.notes ||
                      "ÎπÑÍ≥† Ï∂îÍ∞Ä/ÏàòÏ†ïÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ìï¥Îãπ Í±∞ÎûòÏ≤òÏùò Ïú†ÏùòÏÇ¨Ìï≠ ÎòêÎäî Îã¥ÎãπÏûêÎ≥Ñ Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî."}
                  </span>
                </div>
              </>
            )}
          </div>
        </div>

        {/* üöÄ Ï∂îÍ∞Ä Î≤ÑÌäº */}

        <div className="flex my-4 gap-4">
          {favorites.find((fav: any) => fav.name === companyDetail?.name) ? (
            <div
              className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
              onClick={() => {
                if (companyDetail?.id) {
                  handleRemoveFavorite(companyDetail.id);
                }
              }}
            >
              <span className="mr-2">-</span>
              <span>Ï¶êÍ≤®Ï∞æÍ∏∞ ÏÇ≠Ï†ú</span>
            </div>
          ) : (
            <div
              className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
              onClick={() => handleAddFavorite()}
            >
              <span className="mr-2">+</span>
              <span>Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä</span>
            </div>
          )}
          <div
            className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
            onClick={() => setOpenAddModal(true)}
          >
            <span className="mr-2">+</span>
            <span>ÏÉÅÎã¥ Ï∂îÍ∞Ä</span>
          </div>
          <div
            className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
            onClick={() => setOpenEditContactsModal(true)}
          >
            <span className="mr-2">+</span>
            <span>Îã¥ÎãπÏûê Ï∂îÍ∞Ä/ÏàòÏ†ï</span>
          </div>
          <div
            className="px-4 py-2 font-semibold cursor-pointer hover:bg-opacity-10 hover:bg-black hover:rounded-md"
            onClick={() => setOpenEditNotesModal(true)}
          >
            <span className="mr-2">+</span>
            <span>ÎπÑÍ≥† Ï∂îÍ∞Ä/ÏàòÏ†ï</span>
          </div>
        </div>

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä Î™®Îã¨ */}
        {openAddModal && (
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-1/2 ">
              <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ Ï∂îÍ∞Ä</h3>

              {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
              <div className="mb-4 grid space-x-4 grid-cols-4">
                <div className="">
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïùº
                  </label>
                  <input
                    type="date"
                    value={newConsultation.date}
                    readOnly
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                {/* <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÌõÑÏÜç ÎÇ†Ïßú
                  </label>
                  <input
                    type="date"
                    value={newConsultation.follow_up_date}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        follow_up_date: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div> */}
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    Îã¥ÎãπÏûêÎ™Ö
                  </label>
                  <select
                    defaultValue={newConsultation.contact_name}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        contact_name: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
                    {contacts.map((contact: any) => {
                      if (!contact.resign)
                        return (
                          <option key={contact.id} value={contact.contact_name}>
                            {contact.contact_name} ({contact.level})
                          </option>
                        );
                    })}
                  </select>
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïûê
                  </label>
                  <select
                    value={newConsultation.user_id}
                    disabled
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        user_id: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    {/* Îã§Î•∏ Ïú†Ï†ÄÎì§ */}
                    {users.map((user: any) => (
                      <option key={user.id} value={user.id}>
                        {user.name} {user.level}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
              <div className="mb-4">
                <label className="block mb-2 text-sm font-medium">
                  ÏÉÅÎã¥ ÎÇ¥Ïö©
                </label>
                <textarea
                  placeholder="Îã¥ÎãπÏûêÎ•º ÏÑ†ÌÉùÌõÑ ÏÉÅÎã¥ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. Îã¥ÎãπÏûêÍ∞Ä ÏóÜÏúºÎ©¥ ÏÉÅÎã¥Ïù¥ Ï∂îÍ∞ÄÎêòÏßÄ ÏïäÏäµÎãàÎã§. Îã¥ÎãπÏûêÍ∞Ä ÏóÜÎã§Î©¥ Îã¥ÎãπÏûêÎ•º Ï∂îÍ∞ÄÌõÑ ÏÉÅÎã¥ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî."
                  value={newConsultation.content}
                  onChange={(e) =>
                    setNewConsultation({
                      ...newConsultation,
                      content: e.target.value,
                    })
                  }
                  className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  rows={16}
                />
              </div>

              {/* Î≤ÑÌäº */}
              <div className="flex justify-end space-x-2">
                <button
                  onClick={() => {
                    setOpenAddModal(false);
                    setNewConsultation({
                      date: new Date().toISOString().split("T")[0],
                      follow_up_date: "",
                      user_id: loginUser ? loginUser.id : "",
                      content: "",
                      contact_name: "",
                    });
                  }}
                  className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï∑®ÏÜå
                </button>

                <button
                  onClick={handleAddConsultation}
                  className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï†ÄÏû•
                  {saving && <CircularProgress size={18} className="ml-2" />}
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï Î™®Îã¨ */}
        {openEditModal && (
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-1/2">
              <h3 className="text-xl font-semibold mb-4">ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÏàòÏ†ï</h3>

              {/* ÏÉÅÎã¥Ïùº Î∞è ÌõÑÏÜç ÎÇ†Ïßú (flexÎ°ú Î∞∞Ïπò) */}
              <div className="mb-4 grid grid-cols-4 space-x-4">
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïùº
                  </label>
                  <input
                    type="date"
                    value={newConsultation.date}
                    readOnly
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÌõÑÏÜç ÎÇ†Ïßú
                  </label>
                  <input
                    type="date"
                    value={
                      newConsultation.follow_up_date
                        ? newConsultation.follow_up_date
                        : ""
                    }
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        follow_up_date: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  />
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    Í≥†Í∞ùÎ™Ö
                  </label>
                  <select
                    defaultValue={newConsultation.contact_name}
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        contact_name: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    <option value="">Îã¥ÎãπÏûê ÏÑ†ÌÉù</option>
                    {contacts.map((contact: any) => {
                      if (!contact.resign)
                        return (
                          <option key={contact.id} value={contact.contact_name}>
                            {contact.contact_name} ({contact.level})
                          </option>
                        );
                    })}
                  </select>
                </div>
                <div>
                  <label className="block mb-2 text-sm font-medium">
                    ÏÉÅÎã¥Ïûê
                  </label>

                  <select
                    value={newConsultation.user_id}
                    disabled
                    onChange={(e) =>
                      setNewConsultation({
                        ...newConsultation,
                        user_id: e.target.value,
                      })
                    }
                    className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  >
                    {users.map((user: any) => (
                      <option key={user.id} value={user.id}>
                        {user.name} {user.level}
                      </option>
                    ))}
                  </select>
                </div>
              </div>

              {/* ÏÉÅÎã¥ ÎÇ¥Ïö© */}
              <div className="mb-4">
                <label className="block mb-2 text-sm font-medium">
                  ÏÉÅÎã¥ ÎÇ¥Ïö©
                </label>
                <textarea
                  value={newConsultation.content}
                  onChange={(e) =>
                    setNewConsultation({
                      ...newConsultation,
                      content: e.target.value,
                    })
                  }
                  className="w-full p-2 border border-gray-300 rounded-md text-sm"
                  rows={4}
                />
              </div>

              {/* Î≤ÑÌäº */}
              <div className="flex justify-end space-x-2">
                <button
                  onClick={() => {
                    setOpenEditModal(false);
                    setNewConsultation({
                      date: new Date().toISOString().split("T")[0],
                      follow_up_date: "",
                      user_id: "",
                      content: "",
                      contact_name: "",
                    });
                  }}
                  className={`bg-gray-500 text-white px-4 py-2 rounded-md text-xs md:text-sm ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï∑®ÏÜå
                </button>

                <button
                  onClick={handleUpdateConsultation}
                  className={`bg-blue-500 text-white px-4 py-2 rounded-md text-xs md:text-sm flex items-center ${
                    saving ? "opacity-50 cursor-not-allowed" : ""
                  }`}
                  disabled={saving}
                >
                  Ï†ÄÏû•
                  {saving && <CircularProgress size={18} className="ml-2" />}
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ÏÉÅÎã¥ ÎÇ¥Ïó≠ ÌÖåÏù¥Î∏î */}
        <div className="bg-[#FBFBFB] rounded-md border">
          {consultations.length > 0 && (
            <table className="min-w-full table-auto border-collapse text-center">
              <thead>
                <tr className="bg-gray-100 text-left">
                  {/* <th className="px-4 py-2 border-b border-r-[1px] text-center">
                    No.
                  </th> */}
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÎÇ†Ïßú
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÌîºÏÉÅÎã¥Ïûê
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÏÉÅÎã¥Ïûê
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-5/12">
                    ÎÇ¥Ïö©
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    Î¨∏ÏÑú
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-2/12">
                    ÌååÏùº
                  </th>
                  <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    Î≥ÄÍ≤Ω
                  </th>
                  {/* <th className="px-4 py-2 border-b border-r-[1px] text-center w-1/12">
                    ÏÇ≠Ï†ú
                  </th> */}
                </tr>
              </thead>
              <tbody>
                {processedConsultations.map((consultation: any, index: any) => (
                  <tr
                    key={consultation.id}
                    className="hover:bg-gray-100 border-b"
                  >
                    {/* <td className="px-4 py-2 border-r-[1px]">
                      {consultation.id.slice(0, 4)}
                    </td> */}
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.date}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {consultation.contact_name} {consultation.contact_level}
                    </td>
                    <td className="px-4 py-2 border-r-[1px]">
                      {
                        users.find(
                          (user: any) => user.id === consultation.user_id
                        )?.name
                      }{" "}
                      {
                        users.find(
                          (user: any) => user.id === consultation.user_id
                        )?.level
                      }
                    </td>
                    <td
                      className="px-4 py-2 w-full text-start"
                      style={{
                        minHeight: "140px",
                        maxHeight: "140px",
                        overflowY: "auto",
                        display: "block",
                      }}
                    >
                      {formatContentWithLineBreaks(consultation.content)}
                    </td>
                    <td className="px-4 py-2 border-x-[1px]">
                      <p
                        className={`mb-4 cursor-pointer ${
                          consultation.documents.estimate
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={
                          () =>
                            router.push(
                              `/documents/estimate?consultId=${consultation.id}&compId=${companyDetail?.id}`
                            )
                          // window.open(
                          //   `/documents/estimate?consultId=${consultation.id}&compId=${companyDetail?.id}&fullscreen=true`,
                          //   "_blank",
                          //   "width=1200,height=800,top=100,left=100"
                          // )
                        }
                      >
                        Í≤¨Ï†ÅÏÑú
                      </p>
                      <p
                        className={`my-4 cursor-pointer ${
                          consultation.documents.order
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={
                          () =>
                            router.push(
                              `/documents/order?consultId=${consultation.id}&compId=${companyDetail?.id}`
                            )
                          // window.open(
                          //   `/documents/order?consultId=${consultation.id}&compId=${companyDetail?.id}&fullscreen=true`,
                          //   "_blank",
                          //   "width=1200,height=800,top=100,left=100"
                          // )
                        }
                      >
                        Î∞úÏ£ºÏÑú
                      </p>
                      <p
                        className={`mt-4 cursor-pointer ${
                          consultation.documents.requestQuote
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={
                          () =>
                            router.push(
                              `/documents/requestQuote?consultId=${consultation.id}&compId=${companyDetail?.id}`
                            )
                          // window.open(
                          //   `/documents/requestQuote?consultId=${consultation.id}&compId=${companyDetail?.id}&fullscreen=true`,
                          //   "_blank",
                          //   "width=1200,height=800,top=100,left=100"
                          // )
                        }
                      >
                        ÏùòÎ¢∞ÏÑú
                      </p>
                    </td>
                    <td className="px-2 py-2 border-r-[1px]">
                      <FileUpload
                        consultationId={consultation.id}
                        userId={loginUser?.id}
                      />
                    </td>

                    {/* <td className="px-4 py-2 border-r-[1px]">
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.estimate
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/estimate?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        Í≤¨Ï†ÅÏÑú
                      </span>
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.order
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/order?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        Î∞úÏ£ºÏÑú
                      </span>
                      <span
                        className={`mr-2 cursor-pointer ${
                          consultation.documents.requestQuote
                            ? "text-blue-500 hover:font-bold"
                            : "text-gray-400 hover:text-black"
                        }`}
                        onClick={() =>
                          router.push(
                            `/documents/requestQuote?consultId=${consultation.id}&compId=${companyDetail?.id}`
                          )
                        }
                      >
                        ÏùòÎ¢∞ÏÑú
                      </span>
                    </td> */}
                    <td>
                      <span
                        className={`px-4 py-2 border-r-[1px] ${
                          loginUser?.id === consultation.user_id &&
                          "text-blue-500 cursor-pointer"
                        }`}
                        onClick={() => {
                          if (loginUser?.id === consultation.user_id)
                            handleEditConsultation(consultation);
                        }}
                      >
                        ÏàòÏ†ï
                      </span>
                      <span
                        className={`px-4 py-2 ${
                          loginUser?.id === consultation.user_id &&
                          "text-red-500 cursor-pointer"
                        }`}
                        // onClick={() => {
                        //   handleDeleteConsultation(consultation);
                        // }}
                        onClick={() => {
                          if (loginUser?.id === consultation.user_id)
                            handleDeleteConsultation(consultation);
                        }}
                      >
                        ÏÇ≠Ï†ú
                      </span>
                    </td>
                    {/* <td
                      className={`px-4 py-2 border-r-[1px] ${
                        loginUser?.id === consultation.user_id &&
                        "text-red-500 cursor-pointer"
                      }`}
                      onClick={() => {
                        if (loginUser?.id === consultation.user_id)
                          handleDeleteConsultation(consultation);
                      }}
                    >
                      ÏÇ≠Ï†ú
                    </td> */}
                  </tr>
                ))}
              </tbody>
            </table>
          )}
        </div>

        {/* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */}
        <div className="flex justify-center mt-4 overflow-x-auto space-x-1 md:space-x-2">
          <div className="flex justify-center mt-4 space-x-2">
            <button
              onClick={prevPage}
              disabled={currentPage === 1}
              className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
            >
              Ïù¥Ï†Ñ
            </button>

            {paginationNumbers().map((page, index) => (
              <button
                key={index}
                onClick={() => handlePageClick(Number(page))}
                className={`px-3 py-1 border rounded ${
                  currentPage === page
                    ? "bg-blue-500 text-white font-bold"
                    : "bg-gray-50 text-gray-600 hover:bg-gray-200"
                }`}
              >
                {page}
              </button>
            ))}

            <button
              onClick={nextPage}
              disabled={currentPage === totalPages}
              className="px-3 py-1 border rounded bg-white hover:bg-gray-100"
            >
              Îã§Ïùå
            </button>
          </div>
        </div>
      </>

      {openDeleteModal && consultationToDelete && (
        <motion.div
          initial={{ opacity: 0, scale: 1 }} // ÏãúÏûë Ïï†ÎãàÎ©îÏù¥ÏÖò
          animate={{ opacity: 1, scale: 1 }} // ÎÇòÌÉÄÎÇòÎäî Ïï†ÎãàÎ©îÏù¥ÏÖò
          exit={{ opacity: 0, scale: 1 }} // ÏÇ¨ÎùºÏßà Îïå Ïï†ÎãàÎ©îÏù¥ÏÖò
          transition={{ duration: 0.3 }}
          className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50"
        >
          <div className="bg-white p-6 rounded-md w-1/3">
            <h3 className="text-xl font-semibold mb-4">ÏÇ≠Ï†ú ÏöîÏ≤≠</h3>
            <textarea
              className="w-full border rounded-md p-4 h-48"
              placeholder="ÏÇ≠Ï†ú ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."
              onChange={(e) => setDeleteReason(e.target.value)}
            />

            <div className="flex justify-end space-x-4">
              <button
                onClick={() => setOpenDeleteModal(false)}
                className="bg-gray-500 text-white px-4 py-2 rounded-md"
              >
                Ï∑®ÏÜå
              </button>
              <button
                onClick={handleConfirmDelete}
                className="bg-red-500 text-white px-4 py-2 rounded-md"
              >
                ÏÇ≠Ï†ú
              </button>
            </div>
          </div>
        </motion.div>
      )}
      {openEditNotesModal && (
        <>
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-1/3">
              <h2 className="text-xl font-bold mb-4">ÎπÑÍ≥† Ï∂îÍ∞Ä/ÏàòÏ†ï</h2>
              <textarea
                placeholder="Ìï¥Îãπ Í±∞ÎûòÏ≤òÏùò Ïú†ÏùòÏÇ¨Ìï≠ ÎòêÎäî Îã¥ÎãπÏûêÎ≥Ñ Ïú†ÏùòÏÇ¨Ìï≠ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî."
                className="w-full min-h-80 p-2 border border-gray-300 rounded-md"
                defaultValue={companyDetail.notes}
                onChange={(e) => setNotes(e.target.value)}
              />
              <div className="flex justify-end mt-4">
                <button
                  className="px-4 py-2 bg-gray-500 text-white rounded-md mr-2"
                  onClick={() => setOpenEditNotesModal(false)}
                >
                  Ï∑®ÏÜå
                </button>
                <button
                  className="px-4 py-2 bg-blue-500 text-white rounded-md"
                  onClick={handleUpdateNotes}
                >
                  Ï†ÄÏû•
                </button>
              </div>
            </div>
          </div>
        </>
      )}
      {openEditContactsModal && (
        <>
          <div className="fixed inset-0 flex justify-center items-center bg-gray-500 bg-opacity-50 z-50">
            <div className="bg-white p-6 rounded-md w-4/6 overflow-y-scroll max-h-">
              <h2 className="text-xl font-bold ">Îã¥ÎãπÏûê Ï∂îÍ∞Ä/ÏàòÏ†ï</h2>
              <div>
                <p>
                  Îã¥ÎãπÏûê ÏÇ≠Ï†úÏãú Ïó∞Í¥ÄÎêú Î¨∏ÏÑú(Í≤¨Ï†ÅÏÑú,Î∞úÏ£ºÏÑú,ÏùòÎ¢∞ÏÑú)Í∞Ä Ï°¥Ïû¨Ìï†Ïãú
                  ÏÇ≠Ï†úÎêòÏßÄ ÏïäÏäµÎãàÎã§. Ìá¥ÏÇ¨Î•º ÏÑ†ÌÉùÌïòÎ©¥ Îã¥ÎãπÏûê ÏÑ†ÌÉù Î™©Î°ùÏóê ÎÇòÌÉÄÎÇòÏßÄ
                  ÏïäÏäµÎãàÎã§.
                </p>
              </div>
              <div className="mt-4">
                {/* üìå Îã¥ÎãπÏûê Ìïú Ï§Ñ ÌëúÌòÑ & Ï∂îÍ∞Ä Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Îß® ÏúÑÎ°ú */}
                <div className="space-y-2 max-h-96 overflow-y-scroll">
                  {contactsUi?.map((contact: any, index: any) => {
                    if (!contact.resign)
                      return (
                        <div
                          key={index}
                          className="flex flex-wrap md:flex-nowrap gap-4"
                        >
                          <motion.input
                            whileFocus={{
                              scale: 1.05, // ÏûÖÎ†• Ïãú ÏïΩÍ∞Ñ ÌôïÎåÄ
                              boxShadow: "0px 0px 8px rgba(0, 0, 0, 0.1)", // Í∑∏Î¶ºÏûê Ìö®Í≥º
                            }}
                            type="text"
                            value={contact?.contact_name || ""}
                            onChange={(e) =>
                              handleContactChange(
                                index,
                                "contact_name",
                                e.target.value
                              )
                            }
                            placeholder="Ïù¥Î¶Ñ"
                            className="p-2 border border-gray-300 rounded-md w-full md:w-auto"
                          />
                          <motion.input
                            whileFocus={{
                              scale: 1.05, // ÏûÖÎ†• Ïãú ÏïΩÍ∞Ñ ÌôïÎåÄ
                              boxShadow: "0px 0px 8px rgba(0, 0, 0, 0.1)", // Í∑∏Î¶ºÏûê Ìö®Í≥º
                            }}
                            type="text"
                            value={contact?.level || ""}
                            onChange={(e) =>
                              handleContactChange(
                                index,
                                "level",
                                e.target.value
                              )
                            }
                            placeholder="ÏßÅÍ∏â"
                            className="p-2 border border-gray-300 rounded-md w-full md:w-auto"
                          />

                          <motion.input
                            whileFocus={{
                              scale: 1.05, // ÏûÖÎ†• Ïãú ÏïΩÍ∞Ñ ÌôïÎåÄ
                              boxShadow: "0px 0px 8px rgba(0, 0, 0, 0.1)", // Í∑∏Î¶ºÏûê Ìö®Í≥º
                            }}
                            type="text"
                            value={contact?.department || ""}
                            onChange={(e) =>
                              handleContactChange(
                                index,
                                "department",
                                e.target.value
                              )
                            }
                            placeholder="Î∂ÄÏÑú"
                            className="p-2 border border-gray-300 rounded-md w-full md:w-auto"
                          />

                          <motion.input
                            whileFocus={{
                              scale: 1.05, // ÏûÖÎ†• Ïãú ÏïΩÍ∞Ñ ÌôïÎåÄ
                              boxShadow: "0px 0px 8px rgba(0, 0, 0, 0.1)", // Í∑∏Î¶ºÏûê Ìö®Í≥º
                            }}
                            type="text"
                            value={contact?.mobile || ""}
                            onChange={(e) =>
                              handleContactChange(
                                index,
                                "mobile",
                                e.target.value
                              )
                            }
                            placeholder="Ìú¥ÎåÄÌè∞"
                            className="p-2 border border-gray-300 rounded-md w-full md:w-auto"
                          />
                          <motion.input
                            whileFocus={{
                              scale: 1.05, // ÏûÖÎ†• Ïãú ÏïΩÍ∞Ñ ÌôïÎåÄ
                              boxShadow: "0px 0px 8px rgba(0, 0, 0, 0.1)", // Í∑∏Î¶ºÏûê Ìö®Í≥º
                            }}
                            type="email"
                            value={contact?.email || ""}
                            onChange={(e) =>
                              handleContactChange(
                                index,
                                "email",
                                e.target.value
                              )
                            }
                            placeholder="Ïù¥Î©îÏùº"
                            className="p-2 border border-gray-300 rounded-md w-full md:w-auto"
                          />
                          <motion.label className="flex items-center space-x-2">
                            <motion.input
                              whileTap={{ scale: 0.9 }} // ÌÅ¥Î¶≠ Ïãú ÏïΩÍ∞Ñ Ï∂ïÏÜå Ìö®Í≥º
                              type="checkbox"
                              checked={contact?.resign || false}
                              onChange={(e) =>
                                handleContactChange(
                                  index,
                                  "resign",
                                  e.target.checked
                                )
                              }
                              className="w-5 h-5 accent-blue-500 cursor-pointer"
                            />
                            <span className="text-gray-700">Ìá¥ÏÇ¨</span>
                          </motion.label>

                          {/* <button
                      onClick={() => removeContact(index)}
                      className="px-4 py-2 bg-red-500 text-white text-xs md:text-sm rounded-md"
                    >
                      ÏÇ≠Ï†ú
                    </button> */}
                        </div>
                      );
                  })}
                </div>
              </div>
              <div className="flex justify-between mt-4">
                <div className="flex items-start mr-2 px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 ">
                  <button
                    className=" text-xs md:text-sm rounded-md items-end"
                    onClick={addContact}
                  >
                    Îã¥ÎãπÏûê Ï∂îÍ∞Ä
                  </button>
                </div>

                <div>
                  <button
                    className="px-4 py-2 bg-gray-500 text-white rounded-md mr-2"
                    onClick={() => {
                      setContactsUi(contacts);
                      setOpenEditContactsModal(false);
                    }}
                  >
                    Ï∑®ÏÜå
                  </button>
                  <button
                    className="px-4 py-2 bg-blue-500 text-white rounded-md"
                    onClick={handleUpdateContacts}
                  >
                    Ï†ÄÏû•
                  </button>
                </div>
              </div>
            </div>
          </div>
        </>
      )}
      <SnackbarComponent
        message={snackbarMessage}
        onClose={() => setSnackbarMessage("")}
      />
    </div>
  );
}
